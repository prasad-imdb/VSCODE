CREATE OR REPLACE PROCEDURE POC.OBJECT_TAGS.SP_USP_PRODUCT_SALES_LOAD("LOAD_DATE" DATE)
RETURNS VARCHAR(16777216)
LANGUAGE SQL
EXECUTE AS OWNER
AS '
begin

DELETE FROM POC.OBJECT_TAGS.TD_PRODUCT_SALES;
INSERT INTO POC.OBJECT_TAGS.TD_PRODUCT_SALES  
SELECT TO_DATE(:LOAD_DATE),* FROM POC.OBJECT_TAGS.V_PRODUCT_SALES;

INSERT INTO "POC"."OBJECT_TAGS"."JOB_LOG" VALUES(CURRENT_DATE, ''SP_USP_PRODUCT_SALES_LOAD'', ''COMPLETE'', CURRENT_TIME, '''');
return ''success'';

exception
  when statement_error then
    insert into POC.OBJECT_TAGS.EXCEPTIONS(SCHEMA, STORED_PROCEDURE, ERROR_CODE, ERROR_MSG,TIME_STAMP,RESOLVED) VALUES(''OPEN_REQS'', ''SP_USP_PRODUCT_SALES_LOAD'', :sqlcode, ''Error message is :  '' ||  :sqlerrm, CURRENT_TIMESTAMP, 0);
    return ''Fail'';
  when expression_error then
    insert into POC.OBJECT_TAGS.EXCEPTIONS(SCHEMA, STORED_PROCEDURE, ERROR_CODE, ERROR_MSG,TIME_STAMP,RESOLVED) VALUES(''OPEN_REQS'', ''SP_USP_PRODUCT_SALES_LOAD'', :sqlcode, ''Error message is :  '' ||  :sqlerrm, CURRENT_TIMESTAMP, 0);
    return ''Fail'';
  when other then
    insert into POC.OBJECT_TAGS.EXCEPTIONS(SCHEMA, STORED_PROCEDURE, ERROR_CODE, ERROR_MSG,TIME_STAMP,RESOLVED) VALUES(''OPEN_REQS'', ''SP_USP_PRODUCT_SALES_LOAD'', :sqlcode, ''Error message is :  '' ||  :sqlerrm, CURRENT_TIMESTAMP, 0);
    return ''Fail'';

end;
';