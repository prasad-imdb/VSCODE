CREATE COLUMN TABLE "TBL_STORES_REV_FF" AS
(
SELECT
    "STORE_NAME",
    "PRODUCT_NAME",
    SUM("QUANTITY" * "PRICE") AS revenue
FROM
    "SALES" 
        INNER JOIN
    "PRODUCTS" ON "PRODUCTS"."ID" = "SALES"."PRODUCT_ID"
        INNER JOIN
    "STORES" ON "STORES"."ID" = "SALES"."STORE_ID"
--where "PRODUCT_NAME" = :PROD_NAME
GROUP BY "STORE_NAME" , "PRODUCT_NAME"
);

DELETE FROM "TBL_STORES_REV"
DELETE FROM "TBL_STORES_REV_FF"




PROCEDURE "PRASADKUMAR_BODDU"."PRASADKUMAR_BODDU::TBL_STORES_REV" ( ) 
	LANGUAGE SQLSCRIPT
	SQL SECURITY INVOKER 
	--DEFAULT SCHEMA <default_schema_name>
	--READS SQL DATA 
AS
BEGIN
/*****************************/
INSERT INTO "PRASADKUMAR_BODDU"."TBL_STORES_REV_FF"
SELECT
    "STORE_NAME",
    "PRODUCT_NAME",
    SUM("QUANTITY" * "PRICE") AS revenue
FROM
    "SALES" 
        INNER JOIN
    "PRODUCTS" ON "PRODUCTS"."ID" = "SALES"."PRODUCT_ID"
        INNER JOIN
    "STORES" ON "STORES"."ID" = "SALES"."STORE_ID"
GROUP BY "STORE_NAME" , "PRODUCT_NAME"; 
COMMIT;

TRUNCATE TABLE "PRASADKUMAR_BODDU"."TBL_STORES_REV";

INSERT INTO "PRASADKUMAR_BODDU"."TBL_STORES_REV" 
 SELECT
    "STORE_NAME",
    "PRODUCT_NAME",
    SUM("QUANTITY" * "PRICE") AS revenue
FROM
    "SALES" 
        INNER JOIN
    "PRODUCTS" ON "PRODUCTS"."ID" = "SALES"."PRODUCT_ID"
        INNER JOIN
    "STORES" ON "STORES"."ID" = "SALES"."STORE_ID"
GROUP BY "STORE_NAME" , "PRODUCT_NAME";  
COMMIT;

TRUNCATE TABLE "PRASADKUMAR_BODDU"."TBL_STORES_REV_FF";
COMMIT;

END;


